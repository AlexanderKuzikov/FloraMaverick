# üå∏ FloraMaverick

[![License](https://img.shields.io/badge/License-Apache_2.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
[![GitHub](https://img.shields.io/badge/GitHub-Repository-black.svg)](https://github.com/AlexanderKuzikov/FloraMaverick)

**FloraMaverick** ‚Äî —ç—Ç–æ production-ready Data Ingestion Pipeline –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Ü–≤–µ—Ç–æ—á–Ω—ã—Ö –±—É–∫–µ—Ç–æ–≤. –î–≤–∏–∂–∫–æ–º –º–∞—à–∏–Ω–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è (VLM) –≤—ã—Å—Ç—É–ø–∞–µ—Ç –º–æ–¥–µ–ª—å `meta-llama/llama-4-maverick-17b-128e-instruct`, —Ä–∞–±–æ—Ç–∞—é—â–∞—è —á–µ—Ä–µ–∑ API Groq. 

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—ã—Ä—ã—Ö –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ —Ü–≤–µ—Ç–æ—á–Ω–æ–≥–æ —Å–∞–ª–æ–Ω–∞ (–≤–∫–ª—é—á–∞—è —Ñ–æ—Ç–æ —Å –≤–æ–¥—è–Ω—ã–º–∏ –∑–Ω–∞–∫–∞–º–∏ –∏ —Ü–µ–Ω–Ω–∏–∫–∞–º–∏) –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π, —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON.

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫:** Alexander Kuzikov

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–µ—à–∞–µ—Ç —Ä—è–¥ —Å–ª–æ–∂–Ω—ã—Ö –∏–Ω–∂–µ–Ω–µ—Ä–Ω—ã—Ö –∑–∞–¥–∞—á –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å Large Vision Models (LVM) –∏ –∂–µ—Å—Ç–∫–∏–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏ API.

### 1. –°–µ—Ç–µ–≤–∞—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å (Anti-ECONNRESET & Rate Limiting)
–ü—Ä–∏ –ø–∞–∫–µ—Ç–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ —Ç—è–∂–µ–ª—ã—Ö Base64-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Cloudflare) —á–∞—Å—Ç–æ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç TCP-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (`ECONNRESET`), –Ω–µ –¥–æ–∂–∏–¥–∞—è—Å—å –æ—Ç–≤–µ—Ç–∞ –æ—Ç API.
*   **On-the-fly Image Compression:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–∂–∏–º–∞—é—Ç—Å—è –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `sharp` (–º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä 1000x1000px, JPEG quality 80). –≠—Ç–æ —É–º–µ–Ω—å—à–∞–µ—Ç payload —Å 3‚Äì5 –ú–ë –¥–æ 100‚Äì150 –ö–ë, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è —Ä–∞–∑—Ä—ã–≤—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
*   **Smart Time Parsing:** API Groq –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏ `x-ratelimit-reset-tokens` –≤ —á–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `"7.66s"` –∏–ª–∏ `"2m59.56s"`). –í —Å–∫—Ä–∏–ø—Ç –≤—Å—Ç—Ä–æ–µ–Ω Regex-–ø–∞—Ä—Å–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.
*   **–£–º–Ω—ã–π —Å–æ–Ω:** –°–∫—Ä–∏–ø—Ç –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã. –û–Ω –≤—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–¥–Ω–æ–≥–æ –±—É–∫–µ—Ç–∞ (~8000 —Ç–æ–∫–µ–Ω–æ–≤) –∏ —Å–ø–∏—Ç *—Ä–æ–≤–Ω–æ —Å—Ç–æ–ª—å–∫–æ*, —Å–∫–æ–ª—å–∫–æ —Ç—Ä–µ–±—É–µ—Ç –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞ –∫–æ—Ä–∑–∏–Ω—ã —Ç–æ–∫–µ–Ω–æ–≤.
*   **Retry-–ª–æ–≥–∏–∫–∞:** –õ—é–±—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Å–±–æ–∏ (`fetch failed`) –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è –±–ª–æ–∫–æ–º `try/catch` —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π.

### 2. –ë–æ—Ä—å–±–∞ —Å –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è–º–∏ (Prompt Engineering)
–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏ —á–∞—Å—Ç–æ –ø—É—Ç–∞—é—Ç –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ—Ö–æ–∂–∏–µ —Ü–≤–µ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–∑—ã–≤–∞—é—Ç –∫—Ä—É–≥–ª—É—é –≥–≤–æ–∑–¥–∏–∫—É —Ä–æ–∑–æ–π). –í `bouquets_prompt.js` —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∂–µ—Å—Ç–∫–∏–µ —è–∫–æ—Ä—è:
*   **–î–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è:** –ü—Ä–æ–ø–∏—Å–∞–Ω—ã —á–µ—Ç–∫–∏–µ –æ—Ç–ª–∏—á–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, *¬´–ì–≤–æ–∑–¥–∏–∫–∞ (–¥–∏–∞–Ω—Ç—É—Å) –∏–º–µ–µ—Ç —Ä–µ–∑–Ω–æ–π "–∑—É–±—á–∞—Ç—ã–π" –∫—Ä–∞–π, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≥–ª–∞–¥–∫–æ–π —Ä–æ–∑—ã¬ª*).
*   **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ—Å—Ç—å:** –í–Ω–µ–¥—Ä–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ "–õ—É—á—à–µ –Ω–µ –ø–∏—à–∏ —Ü–≤–µ—Ç–æ–∫, —á–µ–º –≤—ã–¥—É–º—ã–≤–∞–π".
*   **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–æ–≤:** –ú–æ–¥–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∏–º –º–∞—Å—Å–∏–≤–æ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–æ–≤ –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏–π —Ü–≤–µ—Ç–æ–≤ –∏ –∑–µ–ª–µ–Ω–∏.
*   **–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏:** –ö–∞—Ç–µ–≥–æ—Ä–∏—è —Ü–µ–Ω—ã (`price_category`) –≤—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–µ–ª—å—é –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫–µ —Ü–µ–Ω—ã (`parsed_price`), —á—Ç–æ –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏.

### 3. QA Pipeline (–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
–û—Å–æ–±–∞—è –≥–æ—Ä–¥–æ—Å—Ç—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî –Ω–∞–±–æ—Ä —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —ç—Ç–∞–ª–æ–Ω–Ω—ã—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö (Gold Sets) –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ VLM –≤ —á–∞—Ç–∞—Ö LLM.
*   **–ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤–Ω–∏–º–∞–Ω–∏—è –≤ PDF:** –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ LLM –ø–ª–æ—Ö–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å PDF, —Å–æ–¥–µ—Ä–∂–∞—â–∏–º–∏ —Ç–µ–∫—Å—Ç –∏ —Ä–∞—Å—Ç—Ä –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ (–º–æ–¥–µ–ª—å —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Å–ª–æ–µ –∏ "—Å–ª–µ–ø–Ω–µ—Ç" –∫ –ø–∏–∫—Å–µ–ª—è–º).
*   **`make_pdf_images.js`:** –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —á–∏—Å—Ç—ã–µ —Ä–∞—Å—Ç—Ä–æ–≤—ã–µ PDF –±–µ–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ —Å–ª–æ—è + –æ—Ç–¥–µ–ª—å–Ω—ã–π `Mapping.txt`. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç VLM —Å–º–æ—Ç—Ä–µ—Ç—å *—Ç–æ–ª—å–∫–æ –Ω–∞ –ø–∏–∫—Å–µ–ª–∏*.
*   **`make_qa_collages.js`:** –°–æ–±–∏—Ä–∞–µ—Ç –∫–æ–ª–ª–∞–∂–∏ (—Å–µ—Ç–∫–∞ 3x3) —Å –ø–æ–º–æ—â—å—é `sharp` (—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `fit: 'contain'`, —á—Ç–æ–±—ã –Ω–µ –æ–±—Ä–µ–∑–∞—Ç—å —Ü–µ–Ω–Ω–∏–∫–∏ –≤–Ω–∏–∑—É —Ñ–æ—Ç–æ) + —Ç–µ–∫—Å—Ç–æ–≤—ã–π –º–∞–ø–ø–∏–Ω–≥. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤ LLM-—á–∞—Ç—ã –≤ 9 —Ä–∞–∑ –±–æ–ª—å—à–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è —Ñ–ª–æ—Ä–∏—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞.

---

## üóÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö (JSON Schema)

–û—Ç–≤–µ—Ç API –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `response_format: { type: "json_schema" }`. –°—Ç—Ä—É–∫—Ç—É—Ä–∞:
```json
{
  "id": "001",
  "image_file": "photo_2026-01-14.jpg",
  "title": "–°–±–æ—Ä–Ω—ã–π –±—É–∫–µ—Ç —Å –≥–≤–æ–∑–¥–∏–∫–∞–º–∏",
  "description": "–°—Ç—Ä–æ–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –∏–∑ 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.",
  "categories": ["—Å–±–æ—Ä–Ω—ã–π –±—É–∫–µ—Ç", "–∞–≤—Ç–æ—Ä—Å–∫–∏–π –±—É–∫–µ—Ç"],
  "flowers_composition": ["—Ä–æ–∑—ã", "–≥–≤–æ–∑–¥–∏–∫–∏ (–¥–∏–∞–Ω—Ç—É—Å)", "—ç–≤–∫–∞–ª–∏–ø—Ç"],
  "packaging_composition": ["—É–ø–∞–∫–æ–≤–æ—á–Ω–∞—è –±—É–º–∞–≥–∞", "–∞—Ç–ª–∞—Å–Ω–∞—è –ª–µ–Ω—Ç–∞"],
  "parsed_price": 5450,
  "price_category": "–æ—Ç 5000 –¥–æ 7500"
}
```

---

## üõ† –°–æ—Å—Ç–∞–≤ –ø—Ä–æ–µ–∫—Ç–∞

*   `bouquets_prompt.js` ‚Äî –Ø–¥—Ä–æ LLM: –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç + JSON Schema.
*   `process_bouquets.js` ‚Äî –û—Å–Ω–æ–≤–Ω–æ–π –ø–∞–π–ø–ª–∞–π–Ω: –ß—Ç–µ–Ω–∏–µ —Ñ–æ—Ç–æ -> Sharp -> API Groq -> JSONL –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ -> Incremental JSON save.
*   `make_qa_collages.js` ‚Äî QA —É—Ç–∏–ª–∏—Ç–∞: –°–±–æ—Ä–∫–∞ –∫–æ–ª–ª–∞–∂–µ–π –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ –∞—É–¥–∏—Ç–∞.
*   `make_pdf_images.js` ‚Äî QA —É—Ç–∏–ª–∏—Ç–∞: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ –≤ —Ä–∞—Å—Ç—Ä–æ–≤—ã–µ PDF –¥–ª—è bypass-–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –≤–Ω–∏–º–∞–Ω–∏—è.

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   ```bash
   git clone https://github.com/AlexanderKuzikov/FloraMaverick.git
   cd FloraMaverick
   ```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
   ```bash
   npm install
   # –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–∞–∫–µ—Ç—ã: sharp (–¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∏), pdfkit (–¥–ª—è QA-—É—Ç–∏–ª–∏—Ç)
   ```

3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∫–ª—é—á–∏ API:
   –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è Git) –∏ –¥–æ–±–∞–≤—å—Ç–µ:
   ```env
   GROQ_API_KEY=gsk_–≤–∞—à_–∫–ª—é—á
   ```

4. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   –ü–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ (`.jpg`, `.png`, `.webp`) –≤ –ø–∞–ø–∫—É `_–±—É–∫–µ—Ç—ã/`.

5. –ó–∞–ø—É—Å–∫:
   ```bash
   node process_bouquets.js
   ```
   *–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ –≤ —Ñ–∞–π–ª `bouquets_maverick_v2.json`.*

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ª–∏—Ü–µ–Ω–∑–∏—Ä–æ–≤–∞–Ω –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö **Apache License 2.0**. –í—ã –º–æ–∂–µ—Ç–µ —Å–≤–æ–±–æ–¥–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ –ø—Ä–∏ —É—Å–ª–æ–≤–∏–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω–∏—è –∞–≤—Ç–æ—Ä—Å—Ç–≤–∞. –ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –≤ —Ñ–∞–π–ª–µ [LICENSE](LICENSE).
